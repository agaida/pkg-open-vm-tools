Author: Cyril Brulebois <cyril.brulebois@enst-bretagne.fr>
Description: Replacing uname call with KVERS, overwriting seemed not to work.

diff -Naurp open-vm-tools.orig/modules/linux/pvscsi/Makefile open-vm-tools/modules/linux/pvscsi/Makefile
--- open-vm-tools.orig/modules/linux/pvscsi/Makefile	2010-12-14 23:18:47.856337459 +0100
+++ open-vm-tools/modules/linux/pvscsi/Makefile	2010-12-14 23:47:30.807340091 +0100
@@ -43,7 +43,7 @@ INCLUDE      += -I$(SRCROOT)/shared
 endif
 
 
-VM_UNAME = $(shell uname -r)
+VM_UNAME = $(KVERS)
 
 # Header directory for the running kernel
 HEADER_DIR = /lib/modules/$(VM_UNAME)/build/include
diff -Naurp open-vm-tools.orig/modules/linux/vmblock/Makefile open-vm-tools/modules/linux/vmblock/Makefile
--- open-vm-tools.orig/modules/linux/vmblock/Makefile	2010-12-14 23:18:47.876339371 +0100
+++ open-vm-tools/modules/linux/vmblock/Makefile	2010-12-14 23:47:30.807340091 +0100
@@ -43,7 +43,7 @@ INCLUDE      += -I$(SRCROOT)/shared
 endif
 
 
-VM_UNAME = $(shell uname -r)
+VM_UNAME = $(KVERS)
 
 # Header directory for the running kernel
 HEADER_DIR = /lib/modules/$(VM_UNAME)/build/include
diff -Naurp open-vm-tools.orig/modules/linux/vmci/Makefile open-vm-tools/modules/linux/vmci/Makefile
--- open-vm-tools.orig/modules/linux/vmci/Makefile	2010-12-14 23:12:28.580338828 +0100
+++ open-vm-tools/modules/linux/vmci/Makefile	2010-12-14 23:47:30.811339412 +0100
@@ -43,7 +43,7 @@ INCLUDE      += -I$(SRCROOT)/shared
 endif
 
 
-VM_UNAME = $(shell uname -r)
+VM_UNAME = $(KVERS)
 
 # Header directory for the running kernel
 HEADER_DIR = /lib/modules/$(VM_UNAME)/build/include
diff -Naurp open-vm-tools.orig/modules/linux/vmhgfs/Makefile open-vm-tools/modules/linux/vmhgfs/Makefile
--- open-vm-tools.orig/modules/linux/vmhgfs/Makefile	2010-12-14 23:12:28.596340583 +0100
+++ open-vm-tools/modules/linux/vmhgfs/Makefile	2010-12-14 23:47:30.811339412 +0100
@@ -43,7 +43,7 @@ INCLUDE      += -I$(SRCROOT)/shared
 endif
 
 
-VM_UNAME = $(shell uname -r)
+VM_UNAME = $(KVERS)
 
 # Header directory for the running kernel
 HEADER_DIR = /lib/modules/$(VM_UNAME)/build/include
diff -Naurp open-vm-tools.orig/modules/linux/vmmemctl/Makefile open-vm-tools/modules/linux/vmmemctl/Makefile
--- open-vm-tools.orig/modules/linux/vmmemctl/Makefile	2010-12-14 23:18:47.908338197 +0100
+++ open-vm-tools/modules/linux/vmmemctl/Makefile	2010-12-14 23:47:47.995338145 +0100
@@ -43,7 +43,7 @@ INCLUDE      += -I$(SRCROOT)/shared
 endif
 
 
-VM_UNAME = $(shell uname -r)
+VM_UNAME = $(KVERS)
 
 # Header directory for the running kernel
 HEADER_DIR = /lib/modules/$(VM_UNAME)/build/include
diff -Naurp open-vm-tools.orig/modules/linux/vmsync/Makefile open-vm-tools/modules/linux/vmsync/Makefile
--- open-vm-tools.orig/modules/linux/vmsync/Makefile	2010-12-14 23:12:28.612338985 +0100
+++ open-vm-tools/modules/linux/vmsync/Makefile	2010-12-14 23:47:30.811339412 +0100
@@ -43,7 +43,7 @@ INCLUDE      += -I$(SRCROOT)/shared
 endif
 
 
-VM_UNAME = $(shell uname -r)
+VM_UNAME = $(KVERS)
 
 # Header directory for the running kernel
 HEADER_DIR = /lib/modules/$(VM_UNAME)/build/include
diff -Naurp open-vm-tools.orig/modules/linux/vmxnet/Makefile open-vm-tools/modules/linux/vmxnet/Makefile
--- open-vm-tools.orig/modules/linux/vmxnet/Makefile	2010-12-14 23:18:47.912339682 +0100
+++ open-vm-tools/modules/linux/vmxnet/Makefile	2010-12-14 23:47:30.811339412 +0100
@@ -43,7 +43,7 @@ INCLUDE      += -I$(SRCROOT)/shared
 endif
 
 
-VM_UNAME = $(shell uname -r)
+VM_UNAME = $(KVERS)
 
 # Header directory for the running kernel
 HEADER_DIR = /lib/modules/$(VM_UNAME)/build/include
diff -Naurp open-vm-tools.orig/modules/linux/vmxnet3/Makefile open-vm-tools/modules/linux/vmxnet3/Makefile
--- open-vm-tools.orig/modules/linux/vmxnet3/Makefile	2010-12-14 23:18:47.916337606 +0100
+++ open-vm-tools/modules/linux/vmxnet3/Makefile	2010-12-14 23:47:30.815340340 +0100
@@ -43,7 +43,7 @@ INCLUDE      += -I$(SRCROOT)/shared
 endif
 
 
-VM_UNAME = $(shell uname -r)
+VM_UNAME = $(KVERS)
 
 # Header directory for the running kernel
 HEADER_DIR = /lib/modules/$(VM_UNAME)/build/include
diff -Naurp open-vm-tools.orig/modules/linux/vsock/Makefile open-vm-tools/modules/linux/vsock/Makefile
--- open-vm-tools.orig/modules/linux/vsock/Makefile	2010-12-14 23:12:28.624338624 +0100
+++ open-vm-tools/modules/linux/vsock/Makefile	2010-12-14 23:47:30.815340340 +0100
@@ -43,7 +43,7 @@ INCLUDE      += -I$(SRCROOT)/shared
 endif
 
 
-VM_UNAME = $(shell uname -r)
+VM_UNAME = $(KVERS)
 
 # Header directory for the running kernel
 HEADER_DIR = /lib/modules/$(VM_UNAME)/build/include
